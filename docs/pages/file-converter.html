<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Converter - GeoTools Suite</title>
    <link rel="stylesheet" href="../vendor/leaflet/leaflet.css" />
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="./css/file-converter.css" />
    <script src="../vendor/leaflet/leaflet.js"></script>
    <script src="../vendor/proj4.js"></script>
    <script src="../shared/js/crs-registry.js"></script>
    <script src="./js/converter-export.js"></script>
  </head>
  <body>
    <div class="container-converter surface">
      <header class="conv-header">
        <div>
          <p class="eyebrow">Multi-file + live preview</p>
          <h1>File Converter (Survey Files)</h1>
          <p class="sub">
            Upload one or more files, auto-detect order, pick CRS, and see
            points immediately on the map.
          </p>
        </div>
      </header>

      <section
        class="controls-panel surface"
        aria-label="Upload and parsing controls"
      >
        <div class="control-col">
          <label class="control-label">Upload Survey Files (multiple)</label>
          <label class="dropzone" for="csvFiles">
            <span class="drop-icon">📁</span>
            <div>
              <strong>Drop or click to select files</strong>
              <p>
                Supports CSV, TXT, SDR, DXF and common survey text files
                (DAT/XYZ/PTS/RAW/PRN/ASC/GSI/SCR).
              </p>
            </div>
            <input
              type="file"
              id="csvFiles"
              name="csvFiles"
              accept=".csv,.txt,.sdr,.dxf,.dat,.xyz,.pts,.raw,.prn,.asc,.gsi,.scr,text/plain,application/dxf"
              multiple
            />
          </label>
        </div>
        <div class="control-col">
          <label class="control-label">Column order</label>
          <select id="orderSelect">
            <option value="P,N,E,CODE">Point, Northing, Easting, Code</option>
            <option value="P,E,N,CODE">Point, Easting, Northing, Code</option>
            <option value="N,E">Northing, Easting</option>
            <option value="E,N">Easting, Northing</option>
          </select>
          <div class="hint" id="orderHint">Auto-detected: pending</div>
          <label class="control-label" style="margin-top: 16px"
            >Coordinate Reference System</label
          >
          <div id="crsWarning" class="crs-warning-text" aria-live="polite"></div>
          <select id="crsSelect"></select>
          <button id="clearAllBtn" type="button" class="clear-all-btn">Clear All</button>
        </div>
      </section>

      <section class="manual-panel surface" aria-label="Manual point entry">
        <div class="panel-head">
          <div>
            <p class="eyebrow">Manual points</p>
            <h3>Paste points here</h3>
            <p class="sub">
              Auto parses (250ms debounce) and renders instantly.
            </p>
          </div>
          <div class="badge">
            Manual color: <span class="swatch" id="manualSwatch"></span>
          </div>
        </div>
        <textarea
          id="manualInput"
          placeholder="P1, 2768000, 499000, TR1"
        ></textarea>
      </section>

      <section
        class="secondary-panel surface"
        aria-label="Preview and file list"
      >
        <div class="preview-col">
          <label class="control-label">Preview (first 20 rows)</label>
          <div id="previewBox" class="preview-box" aria-live="polite">
            No file selected yet.
          </div>
        </div>
        <div class="filelist-col">
          <label class="control-label">Files</label>
          <div id="fileList" class="file-list" aria-live="polite"></div>
        </div>
      </section>



      <!-- Move toolbar inside map area -->
      <section class="map-panel surface" style="position:relative;">
          <div id="north-arrow" title="NORTH">
            <svg width="38" height="60" viewBox="0 0 38 60" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polygon points="19,4 34,40 19,32 4,40" fill="#fff" stroke="#222" stroke-width="2"/>
              <text x="19" y="55" text-anchor="middle" font-size="18" fill="#222" font-family="Arial">N</text>
            </svg>
          </div>
          <div class="map-controls" style="position:absolute;top:18px;left:18px;z-index:1000;display:flex;flex-direction:column;gap:8px;">
            <button id="zoomInBtn" type="button" title="Zoom In" class="map-icon-btn zoom-btn">+
            </button>
            <button id="zoomOutBtn" type="button" title="Zoom Out" class="map-icon-btn zoom-btn">-
            </button>
            <button id="zoomExtBtn" type="button" title="Zoom Extent" class="map-icon-btn zoom-btn">⤢
            </button>
          </div>
          <div
            id="map"
            class="map-area"
            role="region"
            aria-label="Points map"
          ></div>
          <div class="map-bottom-toolbar">
            <button id="mapModeBtn" type="button" class="map-bottom-btn" aria-pressed="false">
              🌐 Global Map
            </button>
            <button id="measureBtn" type="button" class="map-bottom-btn" aria-pressed="false">
              📏 Distance Measure
            </button>
            <span id="measureTotal" class="measure-total"></span>
          </div>
      </section>

      <section class="actions-panel surface">
        <button id="exportBtn" type="button" class="export-btn">Export to Files</button>
        <div id="status" role="status" aria-live="polite"></div>
      </section>
    </div>

    <script src="./js/file-converter.js"></script>
  </body>
</html>
